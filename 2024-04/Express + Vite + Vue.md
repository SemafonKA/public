# Нелирическое вступление

## О чём пойдёт речь

Этот файл - инструкция, как поднять свой сервак, используя следующий стек технологий:

- Бэкенд (сервер): JavaScript + NodeJs + Express + ViteExpress
- Фронтенд (сайт): HTML + CSS + JavaScript + Vue3 + VueRouter + Vite + ViteExpress

Кажется, будто тут всего очень много, но по факту не настолько и всё при этом достаточно полезное.

!!! warning Про базы данных
    Про БД я пока ничего не пишу, сам хз как их подключать. Потом может дополню, а пока и этого хватит

## Предварительно

1) Убедиться, что у тебя есть браузер.
2) Установить NodeJS ([с оф сайта](https://nodejs.org/en/download))
   1) В конце установки он может попросить поставить галочку на пункте "установить второстепенные сервисы", это сразу отмена, бесполезный скрипт, прикол его не понят. По умолчанию вроде как галочка даже не стоит.
3) Почитать про [JavaScript](https://metanit.com/web/javascript/).

## Немного о стеке

### Бэкенд

#### NodeJS

**NodeJS** - это по факту интерпретатор JS-кода (почти как с питоном). В основном его используют для создания серверных программ, поэтому обычно все уроки по NodeJS превращаются в уроки по созданию сервера. В целом ничего особенного в нём нет, и даже скажу больше - в данном стеке мы даже не будем касаться чистого NodeJS напрямую, всю работу возьмёт на себя Express.

#### Express

**Express** - это фреймворк для удобного создания и запуска сервера на основе NodeJS. По факту, он берёт на себя работу за:

1. предоставление доступа к статическим файлам сервера (файлов, которые берутся не из базы данных);
2. маршрутизацией (позволяет легко определять собственные маршруты, вставлять в них шаблонные параметры, и соответственно обрабатывать ответы);
3. отправление результатов запросов к серверу;
4. подачу красивых веб-страниц пользователю прямо в браузер.

Вот, например, запуск простенького сервера для сайта с одной страничкой (заодно и на JS посмотришь):

```javascript
import express from "express";

const app = express();

app.get("/home", (req, res) => {
    res.send("<h1>Hello, world!</h1>");
});

app.get("/*", (req, res) => {
    res.status(404).send("<h1>Page not founded</h1>");
});

const port = process.env.PORT || 3000;
app.listen(port);
```

Более подробно можно почитать на [metanit](https://metanit.com/web/nodejs/4.1.php). Но по факту от этого фреймворка понадобится знать только:

* `const app = express();` - создание экземпляра сервера;
* `app.get(<путь>, <обработчик>)` - добавление обработчиков по тем или иным путям запросов к серверу;
* `res.send("...")` - просто отправить ответ браузеру;
* `res.status(404)` - отправить браузеру статус ошибки;

Ну и отдельно может понадобиться работа с request, то есть, `req`. В частности, когда понадобиться парсить параметры (обозначается двоеточием в строке запроса, может быть несколько):

```javascript
app.get("/print/:text", (req, res) => {
    res.send(`<h1>Ты ввёл в строку текст ${req.params.text}</h1>`);
});
```

#### ViteExpress

По факту, это обёртка для удобной работы Express и Vite (о Vite чуть позже). С ним особо ничего не меняется:

```javascript
import express from "express";
import ViteExpress from "vite-express";

const app = express();

app.get("/home", (req, res) => {
    res.send("<h1>Hello, world!</h1>");
});

app.get("/*", (req, res) => {
    res.status(404).send("<h1>Page not founded</h1>");
});

const port = process.env.PORT || 3000;
ViteExpress.listen(app, port, () => console.log(`Server is listening at port ${port} ...`));
```

Но он позволяет автоматически управлять твоим приложением, написанным на Vue, и при этом не терять всех плюшек разработки с Vite. Читать про него что-то дополнительное не вижу смысла, всё что от него нужно: функция `ViteExpress.listen`, которая прописывается единожды (причём автоматически самим генератором проекта).

### Фронтенд

#### Vue3

**Vue3** - это грубо говоря фреймворк для удобного разбиения твоего сайта на модули и превращение сайта в полноценное приложение. Что он делает:

1. объединяет все страницы твоего сайта в одну (и это в целом достаточно удобно);
2. позволяет разбивать части твоей страницы на отдельные модули - компоненты (в php было похоже, когда мы отдельно выносили Header и Footer сайта. Тут логика будет совершенно похожая, только php создавал страницы на сервере, а тут - прямо в браузере);
3. позволяет в удобном формате задавать скриптовую логику поведения для компонент HTML (то есть, удобно биндить JavaScript код);
4. позволяет каждую компоненту страницы описывать в одном файле: и HTML, и CSS, и JS код.

Подробнее про Vue3 можно и нужно почитать в [оф документации](https://vuejs.org/guide/introduction.html).

В качестве примера... Ну, посмотри примеры с оф сайта [тут](https://vuejs.org/examples/#hello-world).

!!! info Особенности Vue3
    На Vue3 можно прогать в аж в четырёх вариациях:
    1. В стиле обычных HTML-страниц либо же стиле SFC (Single File Component, весь код каждого элемента в одном файле). Предпочтительным является SFC, поэтому трогать нужно строго его;
    2. В старом стиле объявления компонент (Options API) либо в новом стиле (Comsosition API). Опять же, предпочтительнее использовать именно второй стиль, так как он более простой для запоминания.
    К чему я это? Просто если будешь что-то гуглить, старайся гуглить инфу для SFC и для Composition API.

Из приколов Vue3, которые будут встречаться постоянно:

* переменные, обёрнутые в `ref` либо `computed` - это динамические поля, которые заставляют твой сайт перерисовываться, если их поменять. Это, так называемый, основной элемент реактивного поведения сайта - когда ты что-то поменял и оно тут же применилось, и с ними есть приколы, потом расскажу тоже;
* каждому элементу html можно назначить свойства (думаю, и сам знаешь, типа `href`, `class` и т.д.). Так вот, в vue3 есть два вида назначения свойств: статическое (как ты это делаешь обычно, просто вписывая параметр в строку параметра, типа `class="my-btn"`) и динамическое (когда мы биндим значение к значению переменной, типа `:class="myVariable"`). Как ты можешь заметить, всё отличие в знаке `:` вначале, но разница при этом огромная;
* также, для кнопок вместо стандартных свойств `on-click` нужно использовать собственные свойства `@click`. Во Vue3 все нажатия и прочая хрень обрабатывается не как обычно через простой вызов функции, а через механизм событий (типа кнопка нажалась - создалось событие нажатия этой кнопки), поэтому вместо `on-click` мы фактически привязываем срабатывание какой-либо функции к событию `click`;
* во Vue3 основной скрипт компонент описывается в пункте `script setup`. Но, этот пункт выполняется лишь один раз при загрузке компонента. Если ты захочешь поменять страницу, но компонент оставить тот же, придётся немного исхищряться с его обновлением. Но об этом я расскажу в разделе про Vue Router.

#### VueRouter

**VueRouter** - это пакет, позволяющий добавить внутреннюю навигацию по твоему сайту. Как я уже говорил, Vue3 - позволяет создавать одностраничные сайты "всё в одном", а VueRouter - позволяет добавлять на сайт постраничную навигацию (причём она будет отображаться в браузере нормально, как будто ты реально по страницам гуляешь).

Из приколов, позволяет:

1. добавлять постраничную навигацию
2. хранит историю навигации (в теории, можно спокойно пихать кнопки "назад")
3. позволяет делать предварительные проверки перед совершением навигации (например, в этих проверках можно загружать информацию с сервера, проверять залогинен ли пользователь и в случае чего отменять навигацию).

Поскольку компоненты инициализируются 1 раз, а использоваться могут много раз (например, у тебя есть шаблонная страница, отображающая данные с сервера. При переходе с этой страницы на другую такую же, ничего не поменяется), то роутер в этом плане очень спасает своими проверялками перехода на следующую страницу.

Пример кода с роутером:

```js
import { createWebHistory, createRouter } from 'vue-router';

// Загружаем компоненты для рендера
import Home from '/src/pages/home/Home.vue';
import PageNotFound from '/src/pages/PageNotFound.vue';

// Определяем маршруты нашего сайта
const routes = [
    {
        path: '/',
        name: "HomePage",
        component: Home,
    },
    { 
        path: '/:pathMatch(.*)*', 
        name: "PageNotFound", 
        component: PageNotFound 
    },
]
// Создаём роутер
const router = createRouter({
    history: createWebHistory(),
    routes,
})
// Экспортируем роутер
export default router
```

Про роутер что-то особенное читать не советую - его обычно 1 раз определишь и всё, дальше просто добавляешь маршруты и промежуточные проверки. Но на всякий случай [вот](https://router.vuejs.org/guide/).

#### Vite

**Vite** - это грубо говоря инструмент для удобной разработки и релиза Vue-приложений (сайтов), по совместительству также и компилятор этих приложений. Его плюшки:

1. Умеет обновлять страницы сайта налету (даже если ты добавил новую компоненту, он сам её перезагрузит, возможно даже не потеряя изначальное состояние данных);
2. умеет компилировать страницы в нормальный статический вид (ну как нормальный... просто в код на html + css + many-many-many javascript)

В целом, компонента обязательная, но с ней ничего делать ручками не придётся. Скорее всего, тебе вообще ничего не придётся делать, но на всякий случай оставлю команду:

```shell
npm run build # - команда компиляции твоего сайта в статический формат для дальнейшей публикации
```

# Работа с сайтом

## Создание проекта

1. установи NodeJS. Проверь, что он установлен, терминальными командами `node -v` и `npm -v`;
2. открой терминал в своей рабочей папке, напиши команду `npm create vite-express`:
   1. согласись с установкой пакеты `create-vite-express@X.X.X`,
   2. выбери имя проекта (любое, так назовётся твоя папка с сервером и сайтом),
   3. в списке фреймворков выбери Vue (просто стрелочками клавиатуры),
   4. на вопрос "Использовать ли TypeScript" нажми N.

В результате, должен получиться примерно следующий консольный вывод:

```powershell
PS C:\...> npm create vite-express
Need to install the following packages:
create-vite-express@0.2.0
Ok to proceed? (y) y
√ Project name ... vite-express-project
√ Select a framework » Vue
√ Do you use TypeScript? ... no

Scaffolding app at C:\...\vite-express-project

win32
✔ Done! You can start with:
 1. cd vite-express-project
 2. npm install
 3. npm run dev

Happy hacking! 🎉
```

## Запуск проекта

В целом, на прошлом шаге в консоли уже были указаны верные шаги по запуску проекта. Просто пиши в терминал следующие команды по очереди:

```powershell
cd <имя твоего проекта>
npm install
npm run dev
```

Если всё прошло успешно, в консоли появится лог от работающего сервера, а ты сможешь попасть на шаблонный сайт по адресу http://localhost:3000 в браузере. Для остановки сервера нажми в терминале комбинацию клавиш `CTRL + c` и согласись с остановкой сервера.

На этом этапе терминал можно закрыть, и открыть VS Code в рабочей директории. Из расширений для VS code советую поставить:

* HTML CSS Support (автор: ecmel)
* Vue - Official (автор: vue)

## Структура проекта

Новосозданный проект выглядит следующим образом:

```bash
├───.vscode
├───node_modules    # Модули NodeJS, сюда лезть не надо - только себя разочаровывать
├───public  # Из этой папки будут доступны любые ресурсы при прямых запросах с сервера.
└───src     # Здесь будут лежать исходные коды сайта и сервера
    ├───client  # Клиентская часть приложения
    │   ├───assets  # Всякие картинки с клиента
    │   └───components  # Компоненты сайта
    └───server  # Серверная часть приложения
```

### Public

В этой папке будут лежать ресурсы, которые сервер будет подавать в статическом виде. То есть, если у нас будет лежать картинка в папке `/public/images/cotik.img`, то, если мы напишем в адресную строку браузера http://localhost:3000/images/cotik.img, он вместо нашего сайта вернёт нам картинку.

### client

В этой папке будут находиться исходные коды сайта и сервера. Структура следующая:

```bash
├─── assets 
├─── components
│    ├─── HelloWorld.vue # стандартная компонента сайта, в которой реализован 
│                        # счётчик и несколько справочных ссылок
│
├─── App.vue # главная компонента твоего приложения. Фактически фундамент сайта
├─── main.js # главный скрипт сайта. В нём твоё приложение создаётся и монтируется 
│            # в корень твоего сайта к элементу с классом #app
├─── index.html # главная, и по сути бесполезная, страница сайта. 
│               # Нужна только для подключения скрипта и определения элемента с классом #app
├─── style.css # общие стили, применимые для всего твоего сайта и каждой его компоненты
```

Для знакомства с тем, как вообще проекты будут выглядеть и как будут прогаться, советую сразу изучить внимательно эти файлы, потыкаться на сайте, что-нибудь поменять. Пересоздать проект можно в любой момент.

Если натыкался, то теперь самое время исправить одну упущенную вещь: добавить в проект VueRouter. Для этого необходимо:

1. Открыть терминал в vs code (горячая клавиша: `CTRL + ё`)
2. Написать команду `npm install vue-router`
3. Скрыть терминал тем же хоткеем

Теперь надо создать файл роутера. Для этого создаём по пути `src/client` файл `router.js` и вставляем в него следующий код:

```js
import { createWebHistory, createRouter } from 'vue-router';

// Импортируем компоненту, которую хотим отображать
import HelloWorld from './components/HelloWorld.vue';

// Массив, где будут в будущем перечислены все пути навигации по сайту
const routes = [
    {
        path: '/',
        // name: "HelloWorld",
        component: HelloWorld,
    },
]

// Создаём роутер, сохраняющий историю в веб-формате
const router = createRouter({
    history: createWebHistory(),
    routes,
})

// Экспортируем роутер для последующего удобного импорта из других файлов
export default router
```

Теперь идём в файл `src/client/main.js` и исправляем его на следующий:

```js
import "./style.css";

import { createApp } from "vue";
// Подключаем наш роутер
import router from './router'

import App from "./App.vue";

createApp(App)
    .use(router)  // Говорим использовать роутер в нашем приложении
    .mount("#app");
```

Теперь идём в файл `src/client/App.vue` и меняем его на следующий:

```html
<script setup>
import { RouterView } from 'vue-router'
</script>

<template>
  <div>
    <a href="https://vitejs.dev" target="_blank">
      <img src="/vite.svg" class="logo" alt="Vite logo" />
    </a>
    <a href="https://vuejs.org/" target="_blank">
      <img src="./assets/vue.svg" class="logo vue" alt="Vue logo" />
    </a>
  </div>
  <!-- Меняем компоненту HelloWorld на компоненту RouterView -->
  <RouterView />    
</template>

<style scoped>
.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.vue:hover {
  filter: drop-shadow(0 0 2em #42b883aa);
}
</style>

```

Запускаем сервер через команду `npm run dev`, заходим на http://localhost:3000 и проверяем, что всё так же work.

Единственное НО: пропала надпись Hello world, ибо она передавалась параметром. В случае с навигацией, это всё нужно передавать отдельно, но это сложно, оставлю на потом.

### server

Папка сервера пока что имеет только один файл: `src/server/main.js` - это главный скрипт для запуска сервера. В нём, кстати, по умолчанию определён дополнительный серверный путь `/hello`, при обращении по которому возвращается текст `Hello Vite + Vue!`:

```js
app.get("/hello", (req, res) => {
  res.send("Hello Vite + Vue!");
});
```

Если забить в адресную строку браузера http://localhost:3000/hello, то как раз можно будет увидеть эту надпись вместо нашей страницы.
