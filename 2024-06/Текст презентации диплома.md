# План

1. Вступление (тема диплома, фио)
2. Цель работы
3. Актуальность
   1. Проблемы бумажного документооборота
   2. Проблемы цифрового документооборота
4. Особенности распределённых реестров, как они устроены, почему они безопасны
5. Ethereum
6. Идея выдачи документов в виде NFT в Ethereum
7. Как была решена проблема валидации документов
8. Архитектура приложения
9. Демонстрация выдачи документов
10. Выводы
11. Титульник 

## Вступление

> **Слайд 1**. титульник

Тут в целом и говорить особо нечево

## Введение

> **Слайд 2**. Введение: цели и задачи данной работы

Целью данной работы является разработка системы выдачи электронных 
сертификатов на основе технологии распределённого реестра. 

Для достижения цели были поставлены следующие задачи:

1. изучить и проанализировать принцип работы технологии распределённого реестра, 
выделить отличия различных реализаций данной технологии;
2. провести сравнение наиболее популярных сервисов, основанных на базе 
технологии распределённого реестра;
3. сформулировать требования для разработки системы выдачи электронных 
сертификатов;
4. разработать и протестировать полученный сервис.

## Актуальность темы

> **Слайд 3**. Бумажный документооборот - устаревает
> Проблемы бумажного документооборота:
> 
> 1. требует физического контакта эмитента с получателем
> 2. требует печати, ручных подписей
> 3. занимает физическое место
> 4. легко непреднамеренно испортить
> 5. действительность документа тяжелее проверить

На данный момент большая часть документооборота, связанного с образовательными документами и сертификатами, происходит в бумажном виде. Формат этот хоть и неплохой, но создаёт определённые проблемы:

 1. Потребность личной встречи либо передачи бумаги почтой
 2. требуется печать бумажных версий, их подписывание
 3. занимает физическое место
 4. легко непреднамеренно испортить
 5. действительность документа тяжелее проверить
 6. тяжелее отслеживать процесс выпуска документов

Данные проблемы можно решить путём перехода на электронный документооборот, но в этом формате возникает новая проблема: как проверить, что выданный сертификат является оригинальным и действительным?

> **Слайд 4**. Электронный документооборот - проблема и её решение
> Основная проблема электронных документов - их гораздо легче подделать.
> Возможные решения:
> 1. Цифровая подпись (нужна организация, которая будет её проверять)
> 2. Хранение хэш-суммы сертификата в распределённом реестре

Для решения данной проблемы, чаще всего используется метод цифровой подписи документа. В нём эмитент подписывает своим приватным ключом хэш-сумму документа, и затем, для проверки, зашифрованную сумму можно расшифровать публичным ключом и сверить полученный результат с хэш-суммой полученного документа. При этом для проверки того, что информация об эмитенте в цифровой подписи верна, необходимо воспользоваться сторонней организацией, которая занимается выдачей электронных сертификатов. Но постоянно опираться на одну организацию не является хорошей идеей:

1. Организация должна быть таких масштабов, чтобы ей доверял абсолютно каждый пользователь;
2. Организация чаще всего подконтрольна своему государству, а значит, в случае чего данная организация может попасть под действие санкций в тех или иных странах и, соответственно, потерять возможность выдачи электронных сертификатов организациям некоторых стран.

В качестве альтернативы, можно использовать следующий метод. Эмитент получает хэш-сумму выпускаемого документа, а затем публикует адрес на этот документ и его хэш-сумму в распределённый реестр, подписывая при этом транзакцию своим приватным ключом. К преимуществам данного метода можно отнести следующее:

1. работоспособность распределённого реестра поддерживается не единственным, а множеством узлов, распределённых по всему миру, что значительно повышает надёжность системы, а также делает её значительно менее цензурируемой и подверженной влиянию санкций. 
2. все транзакции в распределённом реестре являются полностью прозрачными, а сам реестр хранит всю историю совершённых транзакций, что позволяет тривиально отследить момент выпуска документа, адрес эмитента и адрес получателя.
3. хэш-сумма документа хранится прямо в блокчейн-сети, что позволяет дополнительно защитить выпускаемый документ даже от изменений этого документа самим эмитентом.
4. сама хэш-сумма хранится в неподписанном формате, что позволяет быстрее выполнить проверку действительности сертификата.

## Структура выдаваемого документа

> **Слайд 5.** Структура выдаваемых документов
> Документы будут выдаваться в формате JSON.  Структура этих документов будет следующей:
> В качестве распределённого реестра - блокчейн Ethereum

Выдаваемые документы будут иметь следующий набор полей, отображённых на слайде. Одно из основных полей данного документа: хэш-сумма документа. Хэш-сумма документа будет формироваться следующим образом:

1. В полученном документе в поля `действителен ли сертификат`, `дата отзыва` и `хэш-сумма` вставляются пустые строки;
2. Удаляются все символы переноса строк, лишние пробелы
3. От полученной строки находится sha-256 хэш  

```json
{
    "name": "Название документа",
    "description": "Описание документа",
    "attributes": [
        {
            "display_type": "number",
            "trait_type": "Номер сертификата в блокчейне",
            "value": "..."
        },
        {
            "trait_type": "Адрес смарт-контракта",
            "value": "..."
        },
        {
            "trait_type": "Публичный адрес студента",
            "value": "..."
        },
        {
            "trait_type": "Публичный адрес компании",
            "value": "..."
        },
        {
            "trait_type": "ФИО студента",
            "value": "..."
        },
        {
            "trait_type": "Название организации",
            "value": "..."
        },
        {
            "trait_type": "Местоположение организации",
            "value": "..."
        },
        {
            "trait_type": "Тип сертификата",
            "value": "..."
        },
        {
            "display_type": "date",
            "trait_type": "Дата создания сертификата",
            "value": "..."
        },
        {
            "trait_type": "Действителен ли сертификат?",
            "value": "..."
        },
        {
            "trait_type": "Дата отзыва сертификата",
            "value": "..."
        },
        {
            "trait_type": "Хэш-сумма сертификата",
            "value": "..."
        }
    ]
}
```

В самом распределённом реестре не будет храниться вся структура целиком в связи с высокой стоимостью на использование ресурсов хранилища реестра. В реестре будет храниться публичный адрес эмитента, публичный адрес владельца, статус актуальности документа, а также его хэш-сумма.

## Распределённый реестр

> **Слайд 6.** Ethereum - один из самых популярных распределённых реестров
> 1. Давно на рынке, доказал свою надёжность
> 2. Активно развивается и не стоит на месте
> 3. Поддерживает исполнение программного кода в лице смарт-контрактов
> 4. Невзаимозаменяемые токены
> 
> NFT + хэш-сумма = способ заверения документов 

В качестве распределённого реестра будет использовать одна из наиболее известных блокчейн сетей Ethereum. Особенностью данной сети является возможность программирования и исполнения программного кода в виде смарт-контрактов прямо в рамках совершения транзакции в сети. 

Одним из наиболее популярных интерфейсов для смарт-контрактов в сети Ethereum является интерфейс IERC721, он же интерфейс невзаимозаменяемых токенов, они же NFT. Особенность NFT в том, что у одного токена может быть только 1 владелец и у каждого токена есть свой владелец. При этом гарантию того, что токенами может распоряжаться лишь их владелец, гарантирует программный код, исполняемый узлами реестра.

Для целей данной работы, стандарт был расширен следующим функционалом:

1. хранение не только владельца токена, но и его эмитента (для добавления возможности отзыва выданного документа)
2. функционал отзыва токена его эмитентом (если тот потерял актуальность), без удаления токена из блокчейн-сети
3. функционал получения хэш-суммы созданного токена

## Разрабатываемое приложение

### Бэкенд

> Слайд 7. Разрабатываемое приложение - сервер
> Сервер: Python + FastAPI + Prisma ORM + Docker
> База данных: PostgreSQL + Adminer

Для удобства работы с распределённым реестром, а также для хранения опубликованных сертификатов, был разработан сервис для выдачи электронных дипломов и сертификатов. Сервис имеет клиент-серверную архитектуру. Серверная часть состоит из двух частей:

1. Сам сервер, написанный с использованием фреймворка FastAPI
2. База данных, работающая на основе СУБД PostgreSQL

Основные задачи серверной части приложения:

1. Хранение информации об организациях, выдающих сертификаты
2. Хранение информации о студентах, добавленных организациями
3. Хранение и выдача информации о выданных дипломах и сертификатах
4. Взаимодействие со смарт-контрактом в сети Ethereum, в том числе публикация новых сертификатов

### Фронтенд

> **Слайд 8.** Разрабатываемое приложение - клиент
> Стек технологий: HTML, CSS, JS, Vue3, Electron

 Клиентское приложение разрабатывалось как кроссплатформенное на основе фреймворка Electron. Данный фреймворк позволяет разрабатывать приложения, которые можно собирать под большинство наиболее популярных платформ без необходимости сложной адаптации программного кода. Разработка при этом на основе привычных web-технологий, поэтому основные этапы разработки не сильно отличаются от разработки web-приложения.

Клиентское приложение предназначено для организаций, позволяя:

1. Регистрировать новую организацию
2. Добавлять и управлять студентами своей организации
3. Загружать новые обложки для графического представления сертификатов
4. Выдавать новые сертификаты

## Фронтенд. Выдача документа

> **Слайд 9.** Выдача документов
> `<изображение загрузки нового сертификата>`


## Фронтенд. Просмотр документа

```json
{
  "name": "О завершении разработки проекта",
  "description": "Сертификат, выданный студенту в честь завершения разработки проекта",
  "external_url": "http://127.0.0.1:8000/info/certs/id/1/view",
  "attributes": [
    {
      "display_type": "number",
      "trait_type": "Номер сертификата",
      "value": 1
    },
    {
      "trait_type": "Адрес смарт-контракта",
      "value": "0xf1f8d2f68afeAed904314a08fB125E2103Df50be"
    },
    {
      "trait_type": "Публичный адрес студента",
      "value": "0x14e6520397F8682231BC368B6Bbc51a2F47f2CF3"
    },
    {
      "trait_type": "Публичный адрес компании",
      "value": "0x99D48BfF35C14d96e9bf348b5e77604AC22649CD"
    },
    {
      "trait_type": "ФИО студента",
      "value": "Самсонов Семён Евгеньевич"
    },
    {
      "trait_type": "Название организации",
      "value": "Клио"
    },
    {
      "trait_type": "Местоположение организации",
      "value": "Новосибирск, Россия"
    },
    {
      "trait_type": "Тип сертификата",
      "value": "Сертификат"
    },
    {
      "display_type": "date",
      "trait_type": "Дата создания сертификата",
      "value": "25.7.2024"
    },
    {
      "trait_type": "Действителен ли сертификат?",
      "value": "Да"
    },
    {
      "trait_type": "Дата отзыва сертификата",
      "value": "Не отозван"
    },
    {
      "trait_type": "Хэш-сумма сертификата",
      "value": "843965c40a29993fc1ad0548a0818def07c9123d5ec785917b05db99e6812dae"
    }
  ]
}
```
